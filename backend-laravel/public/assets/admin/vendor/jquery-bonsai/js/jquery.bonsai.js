!function(e){"function"==typeof define&&define.amd?define(["jquery","jquery-qubit"],e):"object"==typeof exports?e(require("jquery"),require("jquery-qubit")):e(jQuery,jQuery.fn.qubit)}((function(e,t){e.fn.bonsai=function(t){var i=arguments;return this.each((function(){var a=e(this).data("bonsai");if(a||(a=new n(this,t),e(this).data("bonsai",a)),"string"==typeof t)return a[t].apply(a,[].slice.call(i,1))}))},e.bonsai={},e.bonsai.defaults={expandAll:!1,expand:null,collapse:null,addExpandAll:!1,addSelectAll:!1,selectAllExclude:null,idAttribute:"id",createInputs:!1,checkboxes:!1,handleDuplicateCheckboxes:!1,createRadioButtons:!1};var n=function(t,n){var i=this;n=n||{},this.options=e.extend({},e.bonsai.defaults,n),this.el=e(t).addClass("bonsai").data("bonsai",this),this.options.scope||(this.options.scope=this.el),this.update(),this.isRootNode()&&(this.options.createCheckboxes&&(this.createInputs="checkbox"),this.options.handleDuplicateCheckboxes&&this.handleDuplicateCheckboxes(),this.options.checkboxes&&this.el.qubit(this.options),this.options.addExpandAll&&this.addExpandAllLink(),this.options.addSelectAll&&this.addSelectAllLink(),this.el.on("click",".thumb",(function(t){i.toggle(e(t.currentTarget).closest("li"))}))),this.options.expandAll&&this.expandAll()};n.prototype={isRootNode:function(){return this.options.scope==this.el},listItem:function(t){return"object"==typeof t?e(t):this.el.find("["+this.options.idAttribute+'="'+t+'"]')},toggle:function(t){return e(t).hasClass("expanded")?this.collapse(t):this.expand(t)},expand:function(e){return this.setExpanded(e,!0)},collapse:function(e){return this.setExpanded(e,!1)},setExpanded:function(t,n){var i=this.listItem(t);if(!(i.length>1)){if(n){if(!i.data("subList"))return;i=e(i).addClass("expanded").removeClass("collapsed"),e(i.data("subList")).css("height","auto")}else i=e(i).addClass("collapsed").removeClass("expanded"),e(i.data("subList")).height(0);return i}var a=this;i.each((function(){a.setExpanded(this,n)}))},expandAll:function(){this.expand(this.el.find("li"))},collapseAll:function(){this.collapse(this.el.find("li"))},expandTo:function(t){var n=this,i=this.listItem(t);return i.parents("li").each((function(){n.expand(e(this))})),i},update:function(){var t=this;this.el.children().each((function(){var n=e(this);if(t.options.createInputs&&t.insertInput(n),0==n.children().filter(".thumb").length){var i=e('<div class="thumb"></div>');n.prepend(i)}var a=n.children().filter("ol, ul");n.toggleClass("has-children",a.find("li").length>0),a.each((function(){if(0!=e("li",this).length){n.data("subList",this),n.hasClass("expanded")?t.expand(n):t.collapse(n);var i=!!e(this).data("bonsai");e(this).bonsai(i?"update":t.options)}}))})),this.expand=this.options.expand||this.expand,this.collapse=this.options.collapse||this.collapse},serialize:function(){var t=this.options.idAttribute;return this.el.find("li").toArray().reduce((function(n,i){var a=e(i),s=a.attr(t);s&&((a.hasClass("expanded")?"expanded":a.hasClass("collapsed")?"collapsed":null)&&n[a.hasClass("expanded")?"expanded":"collapsed"].push(s));return n}),{expanded:[],collapsed:[],version:2})},restore:function(e){var t=this;e.version>1?(e.expanded.map(this.expand.bind(this)),e.collapsed.map(this.collapse.bind(this))):Object.keys(e).forEach((function(n){t.setExpanded(n,"expanded"===e[n])}))},insertInput:function(t){var n=this.options.createInputs;if(!t.find("> input[type="+n+"]").length){var i=this.inputIdFor(t),a=e('<input type="'+n+'" name="'+this.inputNameFor(t)+'" id="'+i+'" /> '),s=t.children(),l=t.contents().filter((function(){return 3==this.nodeType})).first();a.val(t.data("value")),a.prop("checked",t.data("checked")),s.detach(),t.append(a).append(e('<label for="'+i+'">').append(l.length>0?l:s.first())).append(l.length>0?s:s.slice(1))}},checkboxPrefix:"bonsai-checkbox-",inputIdFor:function(t){for(var i=e(t).data("id");!i||e("#"+i).length>0;)i=this.checkboxPrefix+n.uniqueId++;return i},inputNameFor:function(e){return e.data("name")||e.parents().filter("[data-name]").data("name")},handleDuplicateCheckboxes:function(){var t=this;t.el.on("change","input[type=checkbox]",(function(n){var i=e(n.target);if(i.val()){var a='input[type=checkbox][value="'+i.val()+'"]'+(i.attr("name")?'[name="'+i.attr("name")+'"]':"")+(i.prop("checked")?":not(:checked)":":checked");t.el.find(a).prop({checked:i.prop("checked"),indeterminate:i.prop("indeterminate")}).trigger("change")}}))},addExpandAllLink:function(){var t=this;e('<div class="expand-all">').append(e('<a class="all">Expand all</a>').on("click",(function(){t.expandAll()}))).append('<i class="separator"></i>').append(e('<a class="none">Collapse all</a>').on("click",(function(){t.collapseAll()}))).insertBefore(this.el)},addSelectAllLink:function(){var t=this.options.scope,n=this;function i(){return t.find("li").filter(n.options.selectAllExclude||function(){return"none"!=e(this).css("display")}).find("> input[type=checkbox]")}e('<div class="check-all">').append(e('<a class="all">Select all</a>').css("cursor","pointer").on("click",(function(){i().prop({checked:!0,indeterminate:!1})}))).append('<i class="separator"></i>').append(e('<a class="none">Select none</a>').css("cursor","pointer").on("click",(function(){i().prop({checked:!1,indeterminate:!1})}))).insertAfter(this.el)},setCheckedValues:function(t){var n=this.options.scope.find("input[type=checkbox]");e.each(t,(function(e,t){n.filter('[value="'+t+'"]').prop("checked",!0).trigger("change")}))}},e.extend(n,{uniqueId:0})}));
